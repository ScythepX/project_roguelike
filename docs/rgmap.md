# Формат карт для roguelike.
Карта представляет собой двумерное поле, заполненное тайлами.
Соответственно, карта может содержать некоторую техническую информацию и сам массив тайлов.

## Спецификация файла карты
```
int version # Версия формата карты, инкрементируется при разработке новой спецификации, несовместимой с предыдущей реализацией
string title # название карты
(int, int) size # размер карты
(int, int) spawnpoint
Tile[][] data # тайлы
Script script # скрипт карты(спавн мобов, действия с триггерами и т. д.)
```
`spawnpoint` используется для определения точки возрождения игрока. Игнорируется, если карта является фрагментом другой карты.

## Спецификация тайла в карте
```
int id
int rotation # Поворот тайла(4 положения)
int state # Состояние(открыт/закрыт, разрушен, и проч., используется для триггеров)

# Триггерные действия(для кнопок, рычагов, дверей и проч.)
string action # Действие по триггеру
int trigger_type # Тип триггера
string str_before_triggered
string str_after_triggered

# Дополнительная информация(айтемы в сундуках, типы мобов в спавнерах...)
string data
```
Для экономии места в файле карты, после объявления переменных следует нулевой байт, чтобы дать возможность не записывать в файл неиспользуемые поля. Т. е. можно завершить объявление тайла после определения переменной state, если тайл не триггерный.

## Триггерные тайлы
`action` может содержать название функции, определённой в поле `script` или одно из стандартных:
* `changeState(int state)` - сменить состояние тайла на указанное
* `give(string items[])` - дать игроку айтемы

## Спецификация тайла в списке тайлов
Каждый тайл в игре имеет общие свойства, такие как тип(препятствие, спавн мобов, пол и т. д.), используемые текстуры и прочее. Эти свойства определяются в отдельном файле в формате JSON и имеют следующий вид:
```
[
    {
        id: 0,
        textures: ["wall.png"],
        is_obstacle: True,
        description: "Обычная стена"
    },
    {
        id: 1,
        textures: ["chest.png", "chest_opened.png"],
        is_obstacle: False,
        description: "Сундук",
        type: "chest"
    },
    {
        id: 2,
        textures: ["egg.png", "egg_cracked.png"],
        is_obstacle: False,
        description: "Яйцо дракона",
        type: "spawner",
        default_data: "dragon"
    }
]
```
